<!--姓名：曾锦麟
    班级：软工3班
    实验名称：实验4-4
    实验步骤：
    1. 设计页面布局
    2. 使用dom操作进行表单校验
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>注册</title>
    <style>
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none !important;
        }

        input[type='number'] {
            -moz-appearance: textfield;
        }
    </style>
</head>

<body>
    <div>
        <h1 style="text-align: center;">注册</h1>
        <form action="">
            <div class="form" style="display: flex;flex-direction: column;justify-content: center;align-items: center;">
                <div>
                    <div>
                        <div><span style="color: red;">*</span>姓名：<input type="text" name="realName" id="realName">
                        </div>
                    </div>
                    <br>
                    <div>
                        <div><span style="color: red;">*</span>用户名：<input type="text" name="userName" id="userName">
                        </div>
                    </div>
                    <br>
                    <div>
                        <div><span style="color: red;">*</span>手机号：<input type="text" name="phone" id="phone"></div>
                    </div>
                    <br>
                    <div>
                        <div><span style="color: red;">*</span>性别：<input type="text" name="sex" id="sex" maxlength="1">
                        </div>
                    </div>
                    <br>
                    <div>
                        <div><span style="color: red;">*</span>年龄：<input type="number" name="age" id="age"></div>
                    </div>
                    <br>
                    <div>
                        <div>
                            <div><span style="color: red;">*</span>密码：<input type="password" name="pwd" id="pwd"></div>
                        </div>
                    </div>
                    <br>
                    <div>
                        <div>
                            <div><span style="color: red;">*</span>确认密码<input type="password" name="pwdAgain"
                                    id="pwdAgain">
                            </div>
                        </div>
                    </div>
                    <br>
                    <div style="font-size: 12px;float: right;">已有账号？前往<a href="./login.html">登录</a></div>
                    <br>
                </div>

                <div class="btn">
                    <input type="button" value="注册" onclick="checkForm()">
                    <input type="reset" value="重置">
                </div>
            </div>
        </form>
        <br><br>
        <div style="display: flex;justify-content: center;align-items: center;">
            <div style="border: solid 1px black;padding: 5px;">
                <h2>规则：</h2>
                <p>1. 姓名必须为中文</p>
                <p>2. 用户名不能超过12个字符。</p>
                <p>3. 手机号是中国大陆的手机。</p>
                <p>4. 性别只能是 男 或 女。</p>
                <p>5. 年龄必须大于18。</p>
                <p>6. 密码长度为8~16个字符，且必须包含至少一个大写字母，一个小写字母和一个数字。</p>
                <p>7. 密码和确认密码相同。</p>
                <p>8. 所有文本框均为必填。</p>
            </div>
        </div>

    </div>

    <script>
        const checkRealName = () => {
            const input = document.querySelector("#realName")
            const value = input.value

            const pattern = /^[\u4e00-\u9fa5]{0,}$/

            const father = input.parentNode.parentNode
            const div = document.createElement("div")
            div.style.fontSize = "12px"
            div.style.color = "red"

            if (father.children.length != 1) {
                father.removeChild(father.lastChild)
            }

            if (value == "") {
                div.innerText = `请输入您的姓名。`
                father.append(div)
                return false
            } else if (!pattern.test(value)) {
                div.innerText = `请填写正确的姓名。`
                father.append(div)
                return false
            }
            return true
        }

        const checkUserName = () => {
            const input = document.querySelector("#userName")
            const value = input.value

            const father = input.parentNode.parentNode
            const div = document.createElement("div")
            div.style.fontSize = "12px"
            div.style.color = "red"

            if (father.children.length != 1) {
                father.removeChild(father.lastChild)
            }

            if (value == "") {
                div.innerText = `请输入用户名。`
                father.append(div)
                return false
            } else if (value.length > 12) {
                div.innerText = `用户名不能超过12个字符。`
                father.append(div)
                return false
            }
            return true
        }

        const checkPhone = () => {
            const input = document.querySelector("#phone")
            const value = input.value

            const pattern = /^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\d{8}$/

            const father = input.parentNode.parentNode
            const div = document.createElement("div")
            div.style.fontSize = "12px"
            div.style.color = "red"

            if (father.children.length != 1) {
                father.removeChild(father.lastChild)
            }

            if (value == "") {
                div.innerText = `请输入您的手机号。`
                father.append(div)
                return false
            } else if (!pattern.test(value)) {
                div.innerText = `请填写正确的手机号。`
                father.append(div)
                return false
            }
            return true
        }

        const checkSex = () => {
            const input = document.querySelector("#sex")
            const value = input.value

            const father = input.parentNode.parentNode
            const div = document.createElement("div")
            div.style.fontSize = "12px"
            div.style.color = "red"

            if (father.children.length != 1) {
                father.removeChild(father.lastChild)
            }

            if (value == "") {
                div.innerText = `请填入您的性别。`
                father.append(div)
                return false
            } else if (!(value == "男" || value === "女")) {
                div.innerText = `请填写正确的性别。`
                father.append(div)
                return false
            }
            return true
        }

        const checkAge = () => {
            const input = document.querySelector("#age")
            const value = input.value

            const father = input.parentNode.parentNode
            const div = document.createElement("div")
            div.style.fontSize = "12px"
            div.style.color = "red"

            if (father.children.length != 1) {
                father.removeChild(father.lastChild)
            }

            if (value == "") {
                div.innerText = `请填入您的年龄。`
                father.append(div)
                return false
            } else if (value < 18) {
                div.innerText = `您未满18周岁，请停止注册，谢谢。`
                father.append(div)
                return false
            }
            return true
        }

        const checkPwd = () => {
            const input = document.querySelector("#pwd")
            const value = input.value

            const pattern = /^(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9])[A-Za-z0-9]{8,16}$/

            const father = input.parentNode.parentNode
            const div = document.createElement("div")
            div.style.fontSize = "12px"
            div.style.color = "red"

            if (father.children.length != 1) {
                father.removeChild(father.lastChild)
            }

            if (value == "") {
                div.innerText = `请输入密码`
                father.append(div)
                return false
            } else if (value.length < 8) {
                div.innerText = `密码长度必须为8~16个字符`
                father.append(div)
                return false
            } else if (value.length > 16) {
                div.innerText = `密码长度必须为8~16个字符`
                father.append(div)
                return false
            }
            else if (!pattern.test(value)) {
                div.innerText = `密码至少包含一个大写字母，一个小写字母，\n一个数字和一个特殊字符。`
                father.append(div)
                return false
            }
            return true
        }

        const checkPwdAgain = () => {
            const input = document.querySelector("#pwdAgain")
            const value = input.value

            const pwd = document.querySelector("#pwd").value

            const father = input.parentNode.parentNode
            const div = document.createElement("div")
            div.style.fontSize = "12px"
            div.style.color = "red"

            if (father.children.length != 1) {
                father.removeChild(father.lastChild)
            }

            if (value == "") {
                div.innerText = `请再次输入密码`
                father.append(div)
                return false
            } else if (value != pwd) {
                div.innerText = `两次输入的密码不一致。`
                father.append(div)
                return false
            }
            return true
        }

        const checkForm = () => {
            const realName = checkRealName()
            const userName = checkUserName()
            const phone = checkPhone()
            const sex = checkSex()
            const age = checkAge()
            const pwd = checkPwd()
            const pwdAgain = checkPwdAgain()

            if (realName && userName && phone && sex && age && pwd && pwdAgain) {
                alert("注册成功,即将前往登陆页面")
                window.location.href = './login.html'
            }
        }

    </script>
</body>

</html>